{"ast":null,"code":"var _jsxFileName = \"/Users/mairaquintero/Desktop/project-salas/src/context/ReservationsContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useEffect, useMemo, useState } from \"react\";\n// IMPORTACIONES CRÍTICAS DE MSAL\nimport { msalInstance, loginRequest } from '../msalConfig';\nimport { BrowserAuthError } from '@azure/msal-browser';\n\n// --- ASUNCIONES DE UTILIDADES ---\n// (Estas utilidades deben existir en tus archivos utils)\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialReservations = []; // Asume que tienes un array inicial en tu utils\nconst reviveDates = arr => arr.map(r => ({\n  ...r,\n  startTime: new Date(r.startTime),\n  endTime: new Date(r.endTime)\n}));\nconst toISO = r => ({\n  ...r,\n  startTime: r.startTime.toISOString(),\n  endTime: r.endTime.toISOString()\n});\n// ------------------------------------\n\nconst ReservationsCtx = /*#__PURE__*/createContext(null);\nexport const ReservationsProvider = ({\n  children\n}) => {\n  _s();\n  const [reservations, setReservations] = useState([]);\n\n  // [Tu lógica de localStorage de useEffect está aquí]\n  useEffect(() => {\n    // ... Cargar y guardar en localStorage (omitido por espacio, asumo que funciona)\n    const seeded = initialReservations.map(toISO);\n    setReservations(reviveDates(seeded));\n  }, []);\n  useEffect(() => {\n    // ... Guardar en localStorage cada vez que cambie 'reservations'\n  }, [reservations]);\n\n  // -------------------------------------------------------------\n  // FUNCIÓN ASÍNCRONA DE CREACIÓN/ACTUALIZACIÓN (POST)\n  // -------------------------------------------------------------\n\n  const addOrUpdate = async reservationPayload => {\n    // ... (lógica de adquisición de token, omitida por brevedad)\n    const token = tokenResponse.accessToken;\n\n    // 1. PREPARACIÓN DEL PAYLOAD PARA GRAPH\n    const event = {\n      subject: reservationPayload.title,\n      start: {\n        dateTime: reservationPayload.startTime,\n        timeZone: \"America/Bogota\"\n      },\n      end: {\n        dateTime: reservationPayload.endTime,\n        timeZone: \"America/Bogota\"\n      },\n      // ... (otros campos para Graph)\n      attendees: [{\n        emailAddress: {\n          address: reservationPayload.roomEmail,\n          name: reservationPayload.room.nombre\n        },\n        type: \"resource\"\n      }]\n    };\n\n    // 2. LLAMADA A LA API DE GRAPH\n    const response = await fetch('https://graph.microsoft.com/v1.0/me/events', {\n      // ... (headers y body, omitido por brevedad)\n    });\n\n    // ... (manejo de errores, omitido por brevedad)\n\n    const apiResponse = await response.json();\n\n    // 3. ACTUALIZAR ESTADO LOCAL: COMBINAR DATOS\n    setReservations(prev => {\n      // A. Tomamos la reserva original del formulario (¡que sí tiene el objeto 'room'!)\n      const baseReservation = {\n        ...reservationPayload\n      };\n\n      // B. Le asignamos el ID real que nos dio Microsoft Graph\n      baseReservation.id = apiResponse.id;\n\n      // C. Usamos las fechas confirmadas por la API de Graph\n      baseReservation.startTime = apiResponse.start.dateTime;\n      baseReservation.endTime = apiResponse.end.dateTime;\n\n      // D. Creamos el objeto final con las fechas convertidas a objetos Date\n      const newReservation = reviveDates([baseReservation])[0];\n\n      // E. Actualizamos la lista local\n      const others = prev.filter(x => x.id !== newReservation.id);\n      return [newReservation, ...others];\n    });\n  };\n\n  // -------------------------------------------------------------\n  // FUNCIÓN ASÍNCRONA DE ELIMINACIÓN (DELETE)\n  // -------------------------------------------------------------\n  const removeById = async reservationId => {\n    const account = msalInstance.getActiveAccount();\n    if (!account) throw new Error(\"Debe iniciar sesión para eliminar una reserva.\");\n    const tokenResponse = await msalInstance.acquireTokenSilent({\n      ...loginRequest,\n      account: account\n    });\n    const token = tokenResponse.accessToken;\n    const response = await fetch(`https://graph.microsoft.com/v1.0/me/events/${reservationId}`, {\n      method: 'DELETE',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    if (!response.ok) {\n      throw new Error(`Error al eliminar: ${response.statusText}`);\n    }\n\n    // Si el DELETE fue exitoso (204 No Content), actualizamos el estado local\n    setReservations(prev => prev.filter(r => r.id !== reservationId));\n  };\n\n  // -------------------------------------------------------------\n\n  const value = useMemo(() => ({\n    reservations,\n    addOrUpdate,\n    removeById\n  }), [reservations]);\n  return /*#__PURE__*/_jsxDEV(ReservationsCtx.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 118,\n    columnNumber: 12\n  }, this);\n};\n_s(ReservationsProvider, \"WrTqYW4gbH5IffQStdXGbjG1i4U=\");\n_c = ReservationsProvider;\nexport const useReservations = () => {\n  _s2();\n  const ctx = useContext(ReservationsCtx);\n  if (!ctx) throw new Error(\"useReservations debe usarse dentro de <ReservationsProvider>\");\n  return ctx;\n};\n_s2(useReservations, \"/dMy7t63NXD4eYACoT93CePwGrg=\");\nvar _c;\n$RefreshReg$(_c, \"ReservationsProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","msalInstance","loginRequest","BrowserAuthError","jsxDEV","_jsxDEV","initialReservations","reviveDates","arr","map","r","startTime","Date","endTime","toISO","toISOString","ReservationsCtx","ReservationsProvider","children","_s","reservations","setReservations","seeded","addOrUpdate","reservationPayload","token","tokenResponse","accessToken","event","subject","title","start","dateTime","timeZone","end","attendees","emailAddress","address","roomEmail","name","room","nombre","type","response","fetch","apiResponse","json","prev","baseReservation","id","newReservation","others","filter","x","removeById","reservationId","account","getActiveAccount","Error","acquireTokenSilent","method","headers","ok","statusText","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useReservations","_s2","ctx","$RefreshReg$"],"sources":["/Users/mairaquintero/Desktop/project-salas/src/context/ReservationsContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from \"react\";\n// IMPORTACIONES CRÍTICAS DE MSAL\nimport { msalInstance, loginRequest } from '../msalConfig';\nimport { BrowserAuthError } from '@azure/msal-browser';\n\n// --- ASUNCIONES DE UTILIDADES ---\n// (Estas utilidades deben existir en tus archivos utils)\nconst initialReservations = []; // Asume que tienes un array inicial en tu utils\nconst reviveDates = (arr) => arr.map(r => ({\n    ...r,\n    startTime: new Date(r.startTime),\n    endTime: new Date(r.endTime),\n}));\nconst toISO = (r) => ({\n    ...r,\n    startTime: r.startTime.toISOString(),\n    endTime: r.endTime.toISOString(),\n});\n// ------------------------------------\n\nconst ReservationsCtx = createContext(null);\n\nexport const ReservationsProvider = ({ children }) => {\n    const [reservations, setReservations] = useState([]);\n\n    // [Tu lógica de localStorage de useEffect está aquí]\n    useEffect(() => {\n        // ... Cargar y guardar en localStorage (omitido por espacio, asumo que funciona)\n        const seeded = initialReservations.map(toISO);\n        setReservations(reviveDates(seeded));\n    }, []);\n\n    useEffect(() => {\n        // ... Guardar en localStorage cada vez que cambie 'reservations'\n    }, [reservations]);\n\n\n    // -------------------------------------------------------------\n    // FUNCIÓN ASÍNCRONA DE CREACIÓN/ACTUALIZACIÓN (POST)\n    // -------------------------------------------------------------\n\n    const addOrUpdate = async (reservationPayload) => {\n        // ... (lógica de adquisición de token, omitida por brevedad)\n        const token = tokenResponse.accessToken;\n\n        // 1. PREPARACIÓN DEL PAYLOAD PARA GRAPH\n        const event = {\n            subject: reservationPayload.title,\n            start: { dateTime: reservationPayload.startTime, timeZone: \"America/Bogota\" },\n            end: { dateTime: reservationPayload.endTime, timeZone: \"America/Bogota\" },\n            // ... (otros campos para Graph)\n            attendees: [{\n                emailAddress: { address: reservationPayload.roomEmail, name: reservationPayload.room.nombre },\n                type: \"resource\"\n            }],\n        };\n        \n        // 2. LLAMADA A LA API DE GRAPH\n        const response = await fetch('https://graph.microsoft.com/v1.0/me/events', {\n            // ... (headers y body, omitido por brevedad)\n        });\n\n        // ... (manejo de errores, omitido por brevedad)\n\n        const apiResponse = await response.json();\n\n        // 3. ACTUALIZAR ESTADO LOCAL: COMBINAR DATOS\n        setReservations(prev => {\n            // A. Tomamos la reserva original del formulario (¡que sí tiene el objeto 'room'!)\n            const baseReservation = { ...reservationPayload }; \n            \n            // B. Le asignamos el ID real que nos dio Microsoft Graph\n            baseReservation.id = apiResponse.id; \n            \n            // C. Usamos las fechas confirmadas por la API de Graph\n            baseReservation.startTime = apiResponse.start.dateTime;\n            baseReservation.endTime = apiResponse.end.dateTime;\n\n            // D. Creamos el objeto final con las fechas convertidas a objetos Date\n            const newReservation = reviveDates([baseReservation])[0];\n            \n            // E. Actualizamos la lista local\n            const others = prev.filter(x => x.id !== newReservation.id);\n            return [newReservation, ...others];\n        });\n    };\n    \n    // -------------------------------------------------------------\n    // FUNCIÓN ASÍNCRONA DE ELIMINACIÓN (DELETE)\n    // -------------------------------------------------------------\n    const removeById = async (reservationId) => {\n        const account = msalInstance.getActiveAccount();\n        if (!account) throw new Error(\"Debe iniciar sesión para eliminar una reserva.\");\n\n        const tokenResponse = await msalInstance.acquireTokenSilent({\n            ...loginRequest,\n            account: account\n        });\n        const token = tokenResponse.accessToken;\n        \n        const response = await fetch(`https://graph.microsoft.com/v1.0/me/events/${reservationId}`, {\n            method: 'DELETE',\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n\n        if (!response.ok) {\n            throw new Error(`Error al eliminar: ${response.statusText}`);\n        }\n\n        // Si el DELETE fue exitoso (204 No Content), actualizamos el estado local\n        setReservations(prev => prev.filter(r => r.id !== reservationId));\n    };\n    \n    // -------------------------------------------------------------\n\n    const value = useMemo(() => ({ reservations, addOrUpdate, removeById }), [reservations]);\n\n    return <ReservationsCtx.Provider value={value}>{children}</ReservationsCtx.Provider>;\n};\n\nexport const useReservations = () => {\n    const ctx = useContext(ReservationsCtx);\n    if (!ctx) throw new Error(\"useReservations debe usarse dentro de <ReservationsProvider>\");\n    return ctx;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}