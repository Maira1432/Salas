{"ast":null,"code":"import { acquireToken } from \"./auth\";\n\n// Wrapper genérico\nconst graphFetch = async (endpoint, options = {}) => {\n  const token = await acquireToken();\n  const res = await fetch(`https://graph.microsoft.com/v1.0${endpoint}`, {\n    ...options,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${token}`,\n      ...(options.headers || {})\n    }\n  });\n  if (!res.ok) {\n    const text = await res.text().catch(() => \"\");\n    throw new Error(`Graph error ${res.status}: ${text || res.statusText}`);\n  }\n  return res.status === 204 ? null : res.json();\n};\n\n// Utils de fechas a ISO y TZ UTC\nconst toUTC = d => new Date(d).toISOString(); // ISO en UTC\n\n// Mapeo de tu reserva → Evento Graph\nconst toGraphEvent = reservation => {\n  var _reservation$room;\n  return {\n    subject: reservation.title,\n    body: {\n      contentType: \"HTML\",\n      content: reservation.description || \"\"\n    },\n    start: {\n      dateTime: toUTC(reservation.startTime),\n      timeZone: \"UTC\"\n    },\n    end: {\n      dateTime: toUTC(reservation.endTime),\n      timeZone: \"UTC\"\n    },\n    location: {\n      displayName: ((_reservation$room = reservation.room) === null || _reservation$room === void 0 ? void 0 : _reservation$room.nombre) || \"Sala\"\n    }\n  };\n};\nexport const graphCreateEvent = async reservation => graphFetch(`/me/events`, {\n  method: \"POST\",\n  body: JSON.stringify(toGraphEvent(reservation))\n});\nexport const graphUpdateEvent = async (eventId, reservation) => graphFetch(`/me/events/${eventId}`, {\n  method: \"PATCH\",\n  body: JSON.stringify(toGraphEvent(reservation))\n});\nexport const graphDeleteEvent = async eventId => graphFetch(`/me/events/${eventId}`, {\n  method: \"DELETE\"\n});\n\n// Conflictos de horario (consulta de ventana)\nexport const graphHasConflict = async (startISO, endISO) => {\n  // calendarView requiere zona y rango; pedimos eventos que se crucen\n  const params = new URLSearchParams({\n    startDateTime: startISO,\n    endDateTime: endISO,\n    $select: \"id,subject,start,end,location\"\n  });\n  const data = await graphFetch(`/me/calendar/calendarView?${params.toString()}`);\n  // Si devuelve alguno, asumimos conflicto (puedes filtrar por location si quisieras)\n  return Array.isArray(data.value) && data.value.length > 0;\n};","map":{"version":3,"names":["acquireToken","graphFetch","endpoint","options","token","res","fetch","headers","Authorization","ok","text","catch","Error","status","statusText","json","toUTC","d","Date","toISOString","toGraphEvent","reservation","_reservation$room","subject","title","body","contentType","content","description","start","dateTime","startTime","timeZone","end","endTime","location","displayName","room","nombre","graphCreateEvent","method","JSON","stringify","graphUpdateEvent","eventId","graphDeleteEvent","graphHasConflict","startISO","endISO","params","URLSearchParams","startDateTime","endDateTime","$select","data","toString","Array","isArray","value","length"],"sources":["/Users/mairaquintero/Desktop/project-salas/src/utils/graph.js"],"sourcesContent":["import { acquireToken } from \"./auth\";\n\n// Wrapper genérico\nconst graphFetch = async (endpoint, options = {}) => {\n  const token = await acquireToken();\n  const res = await fetch(`https://graph.microsoft.com/v1.0${endpoint}`, {\n    ...options,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${token}`,\n      ...(options.headers || {}),\n    },\n  });\n  if (!res.ok) {\n    const text = await res.text().catch(() => \"\");\n    throw new Error(`Graph error ${res.status}: ${text || res.statusText}`);\n  }\n  return res.status === 204 ? null : res.json();\n};\n\n// Utils de fechas a ISO y TZ UTC\nconst toUTC = (d) => new Date(d).toISOString(); // ISO en UTC\n\n// Mapeo de tu reserva → Evento Graph\nconst toGraphEvent = (reservation) => ({\n  subject: reservation.title,\n  body: { contentType: \"HTML\", content: reservation.description || \"\" },\n  start: { dateTime: toUTC(reservation.startTime), timeZone: \"UTC\" },\n  end:   { dateTime: toUTC(reservation.endTime),   timeZone: \"UTC\" },\n  location: { displayName: reservation.room?.nombre || \"Sala\" },\n});\n\nexport const graphCreateEvent = async (reservation) =>\n  graphFetch(`/me/events`, {\n    method: \"POST\",\n    body: JSON.stringify(toGraphEvent(reservation)),\n  });\n\nexport const graphUpdateEvent = async (eventId, reservation) =>\n  graphFetch(`/me/events/${eventId}`, {\n    method: \"PATCH\",\n    body: JSON.stringify(toGraphEvent(reservation)),\n  });\n\nexport const graphDeleteEvent = async (eventId) =>\n  graphFetch(`/me/events/${eventId}`, { method: \"DELETE\" });\n\n// Conflictos de horario (consulta de ventana)\nexport const graphHasConflict = async (startISO, endISO) => {\n  // calendarView requiere zona y rango; pedimos eventos que se crucen\n  const params = new URLSearchParams({\n    startDateTime: startISO,\n    endDateTime: endISO,\n    $select: \"id,subject,start,end,location\",\n  });\n  const data = await graphFetch(`/me/calendar/calendarView?${params.toString()}`);\n  // Si devuelve alguno, asumimos conflicto (puedes filtrar por location si quisieras)\n  return Array.isArray(data.value) && data.value.length > 0;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}