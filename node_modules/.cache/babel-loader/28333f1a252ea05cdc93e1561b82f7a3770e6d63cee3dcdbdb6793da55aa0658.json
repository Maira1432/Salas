{"ast":null,"code":"// src/utils/resyncOutlook.js\nimport { msalInstance } from \"../msalConfig\";\nimport { graphCreateEvent, graphUpdateEvent, graphHasConflict } from \"./graph\";\n\n/**\n * Intenta sincronizar una reserva local con Outlook.\n * Devuelve la reserva actualizada (con outlookEventId) o lanza Error.\n */\nexport const resyncReservationToOutlook = async reservation => {\n  const account = msalInstance.getActiveAccount() || msalInstance.getAllAccounts()[0];\n  if (!account) throw new Error(\"No has iniciado sesión en Microsoft.\");\n\n  // Evitar conflicto con otros eventos personales\n  const startISO = new Date(reservation.startTime).toISOString();\n  const endISO = new Date(reservation.endTime).toISOString();\n  const conflict = await graphHasConflict(startISO, endISO, reservation.outlookEventId);\n  if (conflict) {\n    throw new Error(\"Tienes otro evento en Outlook en ese rango horario.\");\n  }\n  if (reservation.outlookEventId) {\n    const ev = await graphUpdateEvent(reservation.outlookEventId, reservation);\n    return {\n      ...reservation,\n      outlookEventId: (ev === null || ev === void 0 ? void 0 : ev.id) || reservation.outlookEventId\n    };\n  } else {\n    const ev = await graphCreateEvent(reservation);\n    return {\n      ...reservation,\n      outlookEventId: ev === null || ev === void 0 ? void 0 : ev.id\n    };\n  }\n};\n\n/**\n * Reintenta varias (útil si más adelante quieres “Sincronizar todas”)\n */\nexport const bulkResyncToOutlook = async (reservations = []) => {\n  const results = [];\n  for (const r of reservations) {\n    try {\n      const updated = await resyncReservationToOutlook(r);\n      results.push({\n        ok: true,\n        reservation: updated\n      });\n    } catch (e) {\n      results.push({\n        ok: false,\n        reservation: r,\n        error: (e === null || e === void 0 ? void 0 : e.message) || String(e)\n      });\n    }\n  }\n  return results;\n};","map":{"version":3,"names":["msalInstance","graphCreateEvent","graphUpdateEvent","graphHasConflict","resyncReservationToOutlook","reservation","account","getActiveAccount","getAllAccounts","Error","startISO","Date","startTime","toISOString","endISO","endTime","conflict","outlookEventId","ev","id","bulkResyncToOutlook","reservations","results","r","updated","push","ok","e","error","message","String"],"sources":["/Users/mairaquintero/Desktop/project-salas/src/utils/resyncOutlook.js"],"sourcesContent":["// src/utils/resyncOutlook.js\nimport { msalInstance } from \"../msalConfig\";\nimport { graphCreateEvent, graphUpdateEvent, graphHasConflict } from \"./graph\";\n\n/**\n * Intenta sincronizar una reserva local con Outlook.\n * Devuelve la reserva actualizada (con outlookEventId) o lanza Error.\n */\nexport const resyncReservationToOutlook = async (reservation) => {\n  const account = msalInstance.getActiveAccount() || msalInstance.getAllAccounts()[0];\n  if (!account) throw new Error(\"No has iniciado sesión en Microsoft.\");\n\n  // Evitar conflicto con otros eventos personales\n  const startISO = new Date(reservation.startTime).toISOString();\n  const endISO = new Date(reservation.endTime).toISOString();\n  const conflict = await graphHasConflict(startISO, endISO, reservation.outlookEventId);\n  if (conflict) {\n    throw new Error(\"Tienes otro evento en Outlook en ese rango horario.\");\n  }\n\n  if (reservation.outlookEventId) {\n    const ev = await graphUpdateEvent(reservation.outlookEventId, reservation);\n    return { ...reservation, outlookEventId: ev?.id || reservation.outlookEventId };\n  } else {\n    const ev = await graphCreateEvent(reservation);\n    return { ...reservation, outlookEventId: ev?.id };\n  }\n};\n\n/**\n * Reintenta varias (útil si más adelante quieres “Sincronizar todas”)\n */\nexport const bulkResyncToOutlook = async (reservations = []) => {\n  const results = [];\n  for (const r of reservations) {\n    try {\n      const updated = await resyncReservationToOutlook(r);\n      results.push({ ok: true, reservation: updated });\n    } catch (e) {\n      results.push({ ok: false, reservation: r, error: e?.message || String(e) });\n    }\n  }\n  return results;\n};\n"],"mappings":"AAAA;AACA,SAASA,YAAY,QAAQ,eAAe;AAC5C,SAASC,gBAAgB,EAAEC,gBAAgB,EAAEC,gBAAgB,QAAQ,SAAS;;AAE9E;AACA;AACA;AACA;AACA,OAAO,MAAMC,0BAA0B,GAAG,MAAOC,WAAW,IAAK;EAC/D,MAAMC,OAAO,GAAGN,YAAY,CAACO,gBAAgB,CAAC,CAAC,IAAIP,YAAY,CAACQ,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;EACnF,IAAI,CAACF,OAAO,EAAE,MAAM,IAAIG,KAAK,CAAC,sCAAsC,CAAC;;EAErE;EACA,MAAMC,QAAQ,GAAG,IAAIC,IAAI,CAACN,WAAW,CAACO,SAAS,CAAC,CAACC,WAAW,CAAC,CAAC;EAC9D,MAAMC,MAAM,GAAG,IAAIH,IAAI,CAACN,WAAW,CAACU,OAAO,CAAC,CAACF,WAAW,CAAC,CAAC;EAC1D,MAAMG,QAAQ,GAAG,MAAMb,gBAAgB,CAACO,QAAQ,EAAEI,MAAM,EAAET,WAAW,CAACY,cAAc,CAAC;EACrF,IAAID,QAAQ,EAAE;IACZ,MAAM,IAAIP,KAAK,CAAC,qDAAqD,CAAC;EACxE;EAEA,IAAIJ,WAAW,CAACY,cAAc,EAAE;IAC9B,MAAMC,EAAE,GAAG,MAAMhB,gBAAgB,CAACG,WAAW,CAACY,cAAc,EAAEZ,WAAW,CAAC;IAC1E,OAAO;MAAE,GAAGA,WAAW;MAAEY,cAAc,EAAE,CAAAC,EAAE,aAAFA,EAAE,uBAAFA,EAAE,CAAEC,EAAE,KAAId,WAAW,CAACY;IAAe,CAAC;EACjF,CAAC,MAAM;IACL,MAAMC,EAAE,GAAG,MAAMjB,gBAAgB,CAACI,WAAW,CAAC;IAC9C,OAAO;MAAE,GAAGA,WAAW;MAAEY,cAAc,EAAEC,EAAE,aAAFA,EAAE,uBAAFA,EAAE,CAAEC;IAAG,CAAC;EACnD;AACF,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMC,mBAAmB,GAAG,MAAAA,CAAOC,YAAY,GAAG,EAAE,KAAK;EAC9D,MAAMC,OAAO,GAAG,EAAE;EAClB,KAAK,MAAMC,CAAC,IAAIF,YAAY,EAAE;IAC5B,IAAI;MACF,MAAMG,OAAO,GAAG,MAAMpB,0BAA0B,CAACmB,CAAC,CAAC;MACnDD,OAAO,CAACG,IAAI,CAAC;QAAEC,EAAE,EAAE,IAAI;QAAErB,WAAW,EAAEmB;MAAQ,CAAC,CAAC;IAClD,CAAC,CAAC,OAAOG,CAAC,EAAE;MACVL,OAAO,CAACG,IAAI,CAAC;QAAEC,EAAE,EAAE,KAAK;QAAErB,WAAW,EAAEkB,CAAC;QAAEK,KAAK,EAAE,CAAAD,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEE,OAAO,KAAIC,MAAM,CAACH,CAAC;MAAE,CAAC,CAAC;IAC7E;EACF;EACA,OAAOL,OAAO;AAChB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}